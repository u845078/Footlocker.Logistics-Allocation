@using Telerik.Web.Mvc;
@{
    ViewBag.Title = "UploadHoldsUpdates";
}

<fieldset>
    <legend>Upload Holds Updates</legend>
    This will mass update Holds<br />
    <br />
    @Html.ActionLink("Download Template", "ExcelUpdateTemplate", new { }, new { @class = "t-button" })
    <br />
    <br />
    <b>The following fields are required in order to change a specified Hold:</b>
    <br />
    <ul style="margin-bottom: 0px;">
        <li>Division</li>
        <li>Level</li>
        <li>Value</li>
        <li>Start Date</li>
    </ul>
    <br />
    <p>
        To mark a hold as deleted, set the End Date to the current date, which will simply let it expire. <br />
        Be sure to check the Pending RDQs page before ending any holds, as you may release more RDQs than you expect!
    </p>
    <p>Remember that store level holds have a level of <strong>All</strong> and a value of <strong>N/A</strong>, and they need to be represented in the spreadsheet as such. </p>
    <p>
        Users are allowed to update the following fields:
        <ul style="margin-bottom: 0px;">
            <li>End Date</li>
            <li>Duration</li>
            <li>Hold Type</li>
            <li>Comments</li>
        </ul>
    </p>
    <br />
    <b>Please select spreadsheets with Hold update to upload: </b>
    <br />
    <br />
    @(Html.Telerik().Upload()
              .Name("attachments")
              .Multiple(true)
              .Async(async => async
                  .Save("MassUpdateHolds", "Hold")                  
                  .AutoUpload(false))
                  .ShowFileList(true)
              .ClientEvents(events => events
                  .OnError("onError")
                  .OnSelect("onSelect")
                  .OnSuccess("onSuccess"))
    )
    <input type="submit" id="spreadsheet" name="create" value="Upload" class="t-button" style="width:150px; visibility: hidden;display:none;" />
    <br />
    <h4 id="message"></h4>
</fieldset>

@Html.ActionLink("Back To List", "Index", null, new { @class = "t-button" })

<script type="text/javascript">
    function onSelect(e) {
        var files = e.files;
        if (files[0].extension != ".xlsx") {
            alert("Document must be a spreadsheet with a xlsx extension. ");
            e.preventDefault();
        }
        else {
            document.getElementById('spreadsheet').style.visibility = 'visible';
        }
        $('#message').empty();
    }

    function onError(e) {
        var message = e.XMLHttpRequest.responseText;
        if (message.indexOf("Incorrectly formatted or missing header row") != -1)
        $('#message').empty().append("<font color='red'>" + message + "</font>");
        else
        $('#message').empty().append("<font color='red'>" + message + "</font><br><a class='t-button' href='DownloadUpdateErrors'>Download Errors</a>");

        e.preventDefault();
    }

    function onSuccess(e) {
        var message = e.XMLHttpRequest.responseText;
        $('#message').empty().append("<font color='red'>Success</font>");

        e.preventDefault();
    }
</script>